<!-- POSTER COVER (tránh *ngIf để không kẹt animation) -->
<section
  class="poster-cover"
  role="dialog"
  aria-modal="true"
  [attr.aria-hidden]="!showCover ? 'true' : 'false'"
  [class.hide]="!showCover"
  [class.force-off]="forceOff"
  (animationend)="onCoverAnimEnd($event)"
>
  <img
    class="poster-media"
    src="assets/Phone/IPhone.jpg"
    alt="TechNoX poster"
    width="1200"
    height="800"
    decoding="async"
    fetchpriority="high"
  />
  <h1 class="poster-title">TECHNO<span>X</span></h1>
  <!-- <button class="poster-skip" type="button" (click)="skipCover()">Skip</button> -->
</section>

<!-- HEADER -->
<header class="site-header">
  <div class="container header-inner">
    <!-- Nút menu: thêm aria-controls/expanded -->
    <button
      class="icon-btn"
      type="button"
      (click)="toggleMenu()"
      aria-label="Mở menu"
      aria-controls="mobileMenu"
      [attr.aria-expanded]="mobileMenuOpen ? 'true' : 'false'"
    >
      ☰
    </button>

    <!-- LOGO -->
    <a class="brand" routerLink="/" aria-label="Trang chủ TechNoX">
      <img
        class="brand__logo"
        src="assets/Phone/Logo.png"
        alt="TechNoX"
        width="200"
        height="40"
        decoding="async"
        fetchpriority="high"
      />
      <span class="brand__name">TechNoX</span>
    </a>

    <div class="header-actions">
      <a class="link-auth" routerLink="/login">Đăng nhập</a>
      <a class="btn btn--accent btn-auth" routerLink="/register">Đăng ký</a>
      <a class="cart" routerLink="/cart" aria-label="Giỏ hàng">Giỏ hàng (0)</a>
    </div>
  </div>
</header>

<!-- MOBILE MENU -->
<nav
  class="mobile-menu"
  id="mobileMenu"
  [class.open]="mobileMenuOpen"
  (click)="closeMenu()"
  aria-label="Menu di động"
>
  <!-- Ngăn click xuyên -->
  <div class="mobile-menu__panel" (click)="$event.stopPropagation()">
    <button class="mobile-menu__close" type="button" (click)="closeMenu()" aria-label="Đóng menu">✕</button>
    <ul>
      <li><a routerLink="/shop" (click)="closeMenu()">Điện thoại</a></li>
      <li><a routerLink="/accessories" (click)="closeMenu()">Phụ kiện</a></li>
      <li><a routerLink="/laptop" (click)="closeMenu()">Laptop</a></li>
      <li><a routerLink="/privacy" (click)="closeMenu()">Chính Sách</a></li>

      <!-- FIX: thiếu dấu () trong closeMenu -->

      <li class="divider" role="separator" aria-hidden="true"></li>
      <li><a routerLink="/login" (click)="closeMenu()">Đăng nhập</a></li>
      <li><a routerLink="/register" (click)="closeMenu()">Đăng ký</a></li>
    </ul>
  </div>
</nav>

<main>
  <!-- HERO -->
  <section class="hero section-pad">
    <div class="container hero__inner">
      <p class="eyebrow">Chúng tôi là TechNoX</p>
      <h1 class="hero__title">SMARTPHONES<br /> FOR EVERYONE</h1>
      <p class="hero__desc">
        Bán lẻ điện thoại chính hãng. Bảo hành 12–24 tháng. Trả góp 0%,
        giao nhanh trong ngày, đổi trả dễ dàng.
      </p>
      <a class="btn btn--accent" href="#" aria-label="Mua ngay">MUA NGAY</a>

      <!-- Hero gallery: ảnh đầu ưu tiên cao, ảnh sau lazy -->
      <div class="hero__gallery">
        <img
          src="assets/Phone/IPhone.jpg"
          alt="Flagship phone"
          width="1200"
          height="800"
          loading="eager"
          decoding="async"
        />
        <img
          src="assets/Phone/Iphone1.jpg"
          alt="Flagship phone"
          width="1200"
          height="800"
          loading="lazy"
          decoding="async"
        />
      </div>
    </div>
  </section>

  <!-- SẢN PHẨM NỔI BẬT -->
  <section class="selected section-pad">
    <div class="container selected__inner">
      <p class="eyebrow eyebrow--gold">Dòng sản phẩm nổi bật</p>
      <h2 class="section-title">ĐIỆN THOẠI<br />ĐƯỢC CHỌN LỌC</h2>

      <!-- #heroGrid: TS ước lượng cột -> heroPageSize -->
      <div #heroGrid class="card-grid">
        <article class="card" *ngFor="let p of heroPaged; trackBy: trackById">
          <a
            class="card__media"
            [style.background-image]="'url(' + p.image + ')'"
            [attr.aria-label]="p.name"
            href="#"
          ></a>
          <div class="card__body">
            <h3 class="card__title">{{ p.name }}</h3>
            <div class="chip-row" *ngIf="p.tags?.length">
              <span class="chip" *ngFor="let t of p.tags">{{ t }}</span>
            </div>
            <p class="price">Từ {{ p.price | number:'1.0-0' }}đ</p>
            <button class="btn btn--block" type="button" (click)="add(p)">THÊM VÀO GIỎ</button>
          </div>
        </article>
      </div>

      <!-- PHẦN PAGER + NÚT XEM THÊM (cân giữa) -->
      <div class="section-cta">
        <nav class="pager" role="navigation" aria-label="Phân trang sản phẩm nổi bật">
          <button
            class="pager__btn"
            type="button"
            (click)="heroPrev()"
            [disabled]="heroPage === 1"
            [attr.aria-disabled]="heroPage === 1"
          >←</button>

          <span class="pager__info">Trang {{ heroPage }} / {{ heroTotalPages }}</span>

          <button
            class="pager__btn"
            type="button"
            (click)="heroNext()"
            [disabled]="heroPage === heroTotalPages"
            [attr.aria-disabled]="heroPage === heroTotalPages"
          >→</button>
        </nav>

        <a class="btn btn--black view-all" [routerLink]="['/san-pham']">
          XEM TOÀN BỘ SẢN PHẨM
        </a>
      </div>
    </div>
  </section>

  <!-- PHỤ KIỆN -->
  <section class="journal section-pad accessories">
    <div class="container">
      <p class="eyebrow eyebrow--gold">Sản phẩm kèm theo</p>
      <h2 class="section-title">PHỤ KIỆN</h2>

      <!-- #catalogGrid: TS ước lượng cột -> pageSize -->
      <div #catalogGrid class="journal-grid">
        <article class="story" *ngFor="let it of paged; trackBy: trackById">
          <a class="story__media" [style.background-image]="'url(' + it.image + ')'" href="#" [attr.aria-label]="it.name"></a>
          <h3 class="story__title">{{ it.name }}</h3>
          <p class="story__meta">{{ it.price | number:'1.0-0' }}đ — {{ it.tags[0] || 'Accessory' }}</p>
        </article>
      </div>

      <!-- PAGER + NÚT XEM THÊM PHỤ KIỆN -->
      <div class="section-cta">
        <nav class="pager" role="navigation" aria-label="Phân trang phụ kiện">
          <button
            class="pager__btn"
            type="button"
            (click)="prevPage()"
            [disabled]="page === 1"
            [attr.aria-disabled]="page === 1"
          >←</button>

          <span class="pager__info">Trang {{ page }} / {{ totalPages }}</span>

          <button
            class="pager__btn"
            type="button"
            (click)="nextPage()"
            [disabled]="page === totalPages"
            [attr.aria-disabled]="page === totalPages"
          >→</button>
        </nav>

        <a class="btn btn--black view-all" routerLink="/shop">XEM THÊM</a>
      </div>
    </div>
  </section>

  <!-- NEWSLETTER -->
  <section class="newsletter">
    <div class="container newsletter__inner">
      <h3>Nhận ưu đãi &amp; voucher hàng tuần</h3>
      <form class="newsletter__form" (submit)="$event.preventDefault()" aria-label="Đăng ký nhận email khuyến mãi">
        <input type="email" placeholder="Email của bạn" required autocomplete="email" />
        <button class="btn" type="submit">ĐĂNG KÝ</button>
      </form>
      <p class="muted small">Bạn có thể hủy nhận email bất cứ lúc nào.</p>
    </div>
  </section>
</main>

<!-- FOOTER -->
<footer class="site-footer">
  <div class="container footer-grid" role="contentinfo">
    <div>
      <div class="brand brand--footer" aria-label="TechNoX">TechNoX</div>
      <p class="muted small">Điện thoại chính hãng — giá tốt.</p>
    </div>
    <div>
      <h4 class="footer-title">Sản phẩm</h4>
      <ul>
        <li><a href="#">Flagship</a></li>
        <li><a href="#">Tầm trung</a></li>
        <li><a href="#">Phụ kiện</a></li>
      </ul>
    </div>
    <div>
      <h4 class="footer-title">Về TechNoX</h4>
      <ul>
        <li><a href="#">Giới thiệu</a></li>
        <li><a href="#">Cửa hàng</a></li>
        <li><a href="#">Tuyển dụng</a></li>
      </ul>
    </div>
    <div>
      <h4 class="footer-title">Hỗ trợ</h4>
      <ul>
        <li><a href="#">Bảo hành</a></li>
        <li><a href="#">Giao hàng</a></li>
        <li><a href="#">Liên hệ</a></li>
      </ul>
    </div>
  </div>

  <div class="container footer-bottom">
    <span class="muted small">© TechNoX — All rights reserved</span>
    <nav class="footer-links" aria-label="Liên kết pháp lý">
      <a href="#">Privacy</a>
      <a href="#">Terms</a>
      <a href="#">Cookies</a>
    </nav>
  </div>
</footer>

<!-- COOKIE BANNER -->
<div
  class="cookie"
  *ngIf="cookieOpen"
  role="dialog"
  aria-live="polite"
  aria-label="Tùy chọn cookie"
>
  <div class="cookie__panel">
    <h4 class="cookie__title">Cookie preference</h4>
    <p class="cookie__text">
      Chúng tôi dùng cookie để cải thiện trải nghiệm của bạn trên website.
    </p>
    <div class="cookie__actions">
      <button class="btn" type="button" (click)="acceptCookies()">ĐỒNG Ý</button>
      <button class="btn" type="button" (click)="refuseCookies()">TỪ CHỐI</button>
      <button class="btn" type="button" (click)="customCookies()">TUỲ CHỈNH</button>
    </div>
  </div>
</div>
