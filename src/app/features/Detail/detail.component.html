<section class="detail section-pad bv-font">
  <div class="container">
    <div class="detail-top">
      <button class="icon-btn back" type="button" (click)="goBack()" aria-label="Quay lại">← Quay lại</button>
    </div>

    <div class="detail-card">
      <div class="detail-grid" *ngIf="!notFound && product as p; else notFoundTpl">
        <!-- LEFT -->
        <div class="detail-left">
          <figure class="gallery">
            <div class="gallery__stage">
              <img class="gallery__img" [src]="p.image || p.gallery?.[0]" [alt]="p.name" />
            </div>
            <figcaption class="gallery__thumbs" *ngIf="p.gallery?.length">
              <button class="thumb" type="button"
                      *ngFor="let g of p.gallery"
                      (click)="p.image = g"
                      [class.active]="(p.image || p.gallery?.[0]) === g">
                <img [src]="g" [alt]="p.name" />
              </button>
            </figcaption>
          </figure>
        </div>

        <!-- RIGHT -->
        <aside class="detail-right">
          <header class="pd-head">
            <h1 class="title">{{ p.name }}</h1>
            <div class="pd-meta">
              <span class="chip" *ngIf="p.inStock; else oosChip">Còn hàng</span>
              <ng-template #oosChip><span class="chip chip--oos">Hết hàng</span></ng-template>
            </div>
          </header>

          <section class="panel">
            <h2 class="panel__title">Giá tiền & Ưu đãi</h2>
            <div class="price-line">
              <span class="price--current">{{ formatPrice(p.price) }}</span>
              <ng-container *ngIf="p.oldPrice">
                <span class="price--old">{{ formatPrice(p.oldPrice) }}</span>
              </ng-container>
            </div>
            <p class="promo" *ngIf="hasPromo">{{ promoText }}</p>
            <div class="chip-row" *ngIf="p.tags?.length">
              <span class="chip" *ngFor="let t of p.tags">{{ t }}</span>
            </div>
          </section>

          <section class="panel">
            <h2 class="panel__title">Số lượng</h2>
            <div class="qty" role="group" aria-label="Chọn số lượng">
              <button type="button" (click)="dec()" aria-label="Giảm">−</button>
              <input [value]="qty" readonly aria-live="polite" />
              <button type="button" (click)="inc()" aria-label="Tăng">+</button>
            </div>
          </section>

          <div class="actions">
            <button class="btn btn--ghost action" type="button" (click)="buyNow()" [disabled]="!p.inStock">Mua ngay</button>
            <button class="btn btn--accent action" type="button" (click)="addToCart()" [disabled]="!p.inStock">Thêm vào giỏ hàng</button>
          </div>
        </aside>
      </div>

      <section class="product-info" *ngIf="product">
        <h2 class="info-title">Thông tin sản phẩm</h2>
        <p class="desc" *ngIf="product.description; else noDesc">{{ product.description }}</p>
        <ng-template #noDesc><p class="muted">Chưa có mô tả cho sản phẩm này.</p></ng-template>
      </section>

      <ng-template #notFoundTpl>
        <div class="state">
          Không tìm thấy sản phẩm.
          <a routerLink="/products" class="btn btn--outline">Về danh sách</a>
        </div>
      </ng-template>
    </div>
  </div>
</section>

